<!DOCTYPE html>
<html>

<head>
    <title>Conceder Permissão</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/permissao.css">
    <link rel="stylesheet" href="css/style-all.css">
</head>

<body style="background-color: #e8e9ea">
    <div class="cor-bg"></div>
    <header>
        <a href="index.html">
            <div id="div-header-logo">
                <img src="assets/index/renderwatch_somente_logo_white.png">
                <img class="renderwatch-header" src="assets/index/renderwatch_somente_palavra_white.png">
            </div>
        </a>
        <div class="menu">
            <ul>
                <div class="link">
                    <a href="perfil-download.html"><img class="perfil-configuracoes-icon"
                            src="assets/perfil/botaodownload.png"></a>
                    <li><a style="margin-left: 12px;" href="perfil-download.html">Download</a></li>
                </div>
                <div class="link">
                    <a href="perfil-relatorio.html"><img class="perfil-configuracoes-icon"
                            src="assets/perfil/relatorio (1).png" alt=""></a>
                    <li><a style="margin-left: 12px;" href="perfil-relatorio.html">Relatórios</a></li>
                </div>
                <div class="link">
                    <a href="perfil-configuracoes.html"><img class="perfil-configuracoes-icon"
                            src="assets/perfil/setting.png" alt=""></a>
                    <li><a href="perfil-configuracoes.html">Configurações</a></li>
                </div>
                <div class="link" onclick="logout()">
                    <span><img class="perfil-logout-icon" src="assets/perfil/log-out.png" alt=""></span>
                    <li><span>Sair</span></li>
                </div>
            </ul>
        </div>
    </header>
    <sidebar>
        <div class="sidebar">
            <ul>
                <li><a href="perfil-empresa.html" class="sidebar-element">
                        <div>Empresa</div>
                    </a></li>
                <li><a href="permissao.html" class="sidebar-element">
                        <div>Permissões</div>
                    </a></li>
                <li><a href="perfil-alertas.html" class="sidebar-element">
                        <div>Alertas</div>
                    </a></li>
                <li><a href="perfil-dashboard.html" class="sidebar-element">
                        <div>Dashboard</div>
                    </a></li>
                <li><a href="perfil-clusters.html" class="sidebar-element">
                        <div>Clusters</div>
                    </a></li>
                <li><a href="perfil-rede.html" class="sidebar-element">
                        <div>Rede</div>
                    </a></li>
                <li><a href="https://renderwatch.auvo.com.br/Login#signin" target="_blank" class="sidebar-element">
                        <div>Suporte</div>
                    </a></li>
            </ul>
        </div>
    </sidebar>
    <br><br><br>
    <main class="spaceTop">
        <h2>Permissão</h2>
        <form id="conceder-permissao-form">
            <label for="email">E-mail:</label>
            <input type="email" id="email" name="email" required>
            <br>
            <label for="permissao">Permissão administrador:</label>
            <input type="checkbox" id="permissao" name="permissao">
            <br>
            <button type="submit" onclick="atualizarFeed()">Conceder permissão</button>
        </form>
        <hr>
        <h2>Permissões Concedidas</h2>
        <table id="permissao-table">
            <thead>
                <tr>
                    <th>E-mail</th>
                    <th>Permissão</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- linhas da tabela vão ser adicionadas dinamicamente com javascript -->
            </tbody>
        </table>
    </main>
</body>

</html>

<!-- <script src="js/perfil-permissao.js"></script> -->
<script src="js/perfil-sidebar-header.js"></script>

<script>
    // document.addEventListener("DOMContentLoaded", function () {
    //     b_usuario.innerHTML = sessionStorage.ID_USUARIO;

    //     function limparFormulario() {
    //         document.getElementById("form_postagem").reset();
    //     }

    //     function editar(ID_USUARIO) {
    //         sessionStorage.ID_USUARIO = ID_USUARIO;
    //         console.log("cliquei em editar - " + ID_USUARIO);
    //         window.alert("Você será redirecionado à página de edição do aviso de id número: " + ID_USUARIO);
    //         window.location = "/public/permissao.html";
    //     }

    //     function deletar(EMAIL_USUARIO) {
    //         console.log("Criar função de apagar post escolhido - ID" + EMAIL_USUARIO);
    //         fetch(`/permissao/deletar/${EMAIL_USUARIO}`, {
    //             method: "DELETE",
    //             headers: {
    //                 "Content-Type": "application/json"
    //             }
    //         }).then(function (resposta) {
    //             if (resposta.ok) {
    //                 window.alert("Post deletado com sucesso pelo usuário de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
    //                 window.location = "/public/permissao.html";
    //             } else if (resposta.status == 404) {
    //                 window.alert("Deu 404!");
    //             } else {
    //                 throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
    //             }
    //         }).catch(function (resposta) {
    //             console.log(`#ERRO: ${resposta}`);
    //         });
    //     }
    // });

    function listar() {
    fetch("/permissao/listar").then(function (resposta) {
        if (resposta.ok) {
            if (resposta.status == 204) {
                var tbody = document.querySelector("#permissao-table tbody"); // Atualização do seletor
                var mensagem = document.createElement("span");
                mensagem.innerHTML = "Nenhum resultado encontrado.";
                tbody.appendChild(mensagem);
                throw "Nenhum resultado encontrado!!";
            }

            resposta.json().then(function (resposta) {
                console.log("Dados recebidos: ", JSON.stringify(resposta));

                var tbody = document.querySelector("#permissao-table tbody"); // Atualização do seletor
                tbody.innerHTML = "";

                const permissoesConcedidas = resposta.map(item => ({
                    email: item.email,
                    adm: item.adm
                }));

                for (let i = 0; i < resposta.length; i++) {
                    var publicacao = resposta[i];

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${resposta[i].email}</td>
                        <td>
                            <label>
                                <input type="checkbox" ${resposta[i].adm !== 0 ? 'checked' : ''} disabled>
                            </label>
                        </td>
                        <td>
                            <button class="editar-button">Editar</button>
                            <button class="salvar-button" style="display: none;">Salvar</button>
                            <button class="excluir-button">Excluir</button>
                        </td>
                    `;

                    // Adicione a linha à tabela
                    tbody.appendChild(tr);
                }
            });
        } else {
            throw ('Houve um erro na API!');
        }
    }).catch(function (resposta) {
        console.error(resposta);
    });
}

listar();


</script>